# Telegram Bot для анализа плейлистов

Бот для поиска концертов по плейлистам Яндекс Музыки.

## Структура

- `main.py` - точка входа бота
- `handlers/` - обработчики сообщений и callback-кнопок
  - `playlist_handler.py` - обработка плейлистов и поиск концертов
  - `callback_handler.py` - обработка кнопок (фильтры, сортировка, пагинация)
- `utils.py` - утилиты для форматирования сообщений и клавиатур

## Запуск

1. Убедитесь, что в корне проекта есть файл `.env` с переменными:
   ```
   BOT_TOKEN=your_telegram_bot_token
   YANDEX_MUSIC_TOKEN=your_yandex_music_token
   TICKETMASTER_API_TOKEN=your_ticketmaster_api_token
   GEMINI_API_KEY=your_gemini_api_key  # Для AI-рекомендаций
   ```

2. **Важно**: Перед запуском бота загрузите 100 артистов в Ticketmaster:
   ```bash
   # Запустите обновление Ticketmaster для 100 артистов
   cd src
   python -m clients.global_concert_client --limit 100
   ```
   Это загрузит концерты для 100 популярных артистов в базу данных.

3. Запустите бота:
   ```bash
   python bot/main.py
   ```

## Использование

1. Отправьте боту команду `/start`
2. Отправьте ссылку на публичный плейлист Яндекс Музыки (можно в формате HTML с iframe)
3. Дождитесь обработки (2-3 минуты)
4. Получите список концертов с возможностью фильтрации по городу, сортировки и пагинации

## Функции

- ✅ Анализ плейлистов Яндекс Музыки
- ✅ Поиск концертов по артистам из плейлиста:
  - В базе данных (Яндекс Афиша + предзагруженные 100 артистов из Ticketmaster)
  - В реальном времени через Ticketmaster API (первые 20 артистов из плейлиста пользователя)
- ✅ Фильтрация по городам
- ✅ Сортировка по дате или артисту
- ✅ Пагинация результатов
- ✅ Добавление напоминаний о концертах
- ✅ AI-рекомендации на основе музыкальных предпочтений (кнопка "✨ Рекомендовано вам")

